# Lifecycle Protocol


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Lifecycle-Aware Plugin Protocol

This protocol defines the interface for plugins that manage external
resources like: - Child processes (e.g., vLLM servers) - Docker
containers - Conda environments - Remote/cloud resources

Plugins implementing this protocol provide information about their
managed resources, enabling proper resource tracking and cleanup.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-plugins/blob/main/cjm_fasthtml_plugins/protocols/lifecycle.py#L15"
target="_blank" style="float:right; font-size:smaller">source</a>

### LifecycleAwarePlugin

>  LifecycleAwarePlugin (*args, **kwargs)

*Protocol for plugins that manage external resources like child
processes, containers, or cloud resources.*

## Example Implementation

Hereâ€™s how a plugin with a subprocess (like vLLM server) would implement
this protocol:

``` python
# Example: Simple subprocess-based plugin
import subprocess
from typing import Optional

class MockVLLMPlugin:
    """Mock plugin that spawns a subprocess."""
    
    def __init__(self):
        self.process: Optional[subprocess.Popen] = None
    
    def start_server(self):
        """Start mock server process."""
        # In reality, this would start vLLM server
        self.process = subprocess.Popen(['sleep', '3600'])
        print(f"Started server with PID: {self.process.pid}")
    
    # Implement LifecycleAwarePlugin protocol
    
    def get_execution_mode(self) -> PluginExecutionMode:
        return PluginExecutionMode.SUBPROCESS
    
    def get_child_pids(self) -> List[int]:
        if self.process and self.process.poll() is None:
            return [self.process.pid]
        return []
    
    def get_managed_resources(self) -> Dict[str, Any]:
        return {
            'server_url': 'http://localhost:8000',
            'is_running': self.process is not None and self.process.poll() is None,
            'pid': self.process.pid if self.process else None
        }
    
    def force_cleanup(self) -> None:
        if self.process:
            self.process.kill()
            self.process.wait()
            print("Killed server process")
```

``` python
# Test the mock plugin
plugin = MockVLLMPlugin()

# Check it implements the protocol
print(f"Implements protocol: {isinstance(plugin, LifecycleAwarePlugin)}")

# Start server
plugin.start_server()

# Get execution mode
print(f"Execution mode: {plugin.get_execution_mode().value}")

# Get child PIDs
pids = plugin.get_child_pids()
print(f"Child PIDs: {pids}")

# Get managed resources
resources = plugin.get_managed_resources()
print(f"Managed resources: {resources}")

# Cleanup
plugin.force_cleanup()
print(f"After cleanup, child PIDs: {plugin.get_child_pids()}")
```

    Implements protocol: True
    Started server with PID: 576998
    Execution mode: subprocess
    Child PIDs: [576998]
    Managed resources: {'server_url': 'http://localhost:8000', 'is_running': True, 'pid': 576998}
    Killed server process
    After cleanup, child PIDs: []

## Helper Functions

Utilities for working with lifecycle-aware plugins.

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-plugins/blob/main/cjm_fasthtml_plugins/protocols/lifecycle.py#L40"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_all_managed_pids

>  get_all_managed_pids (plugin:Any)

*Get all PIDs managed by a plugin (including children).*

<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 38%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin</td>
<td>Any</td>
<td>Plugin instance</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>List</strong></td>
<td><strong>List of all PIDs (empty if plugin not
lifecycle-aware)</strong></td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/cj-mills/cjm-fasthtml-plugins/blob/main/cjm_fasthtml_plugins/protocols/lifecycle.py#L35"
target="_blank" style="float:right; font-size:smaller">source</a>

### is_lifecycle_aware

>  is_lifecycle_aware (plugin:Any)

*Check if a plugin implements the LifecycleAwarePlugin protocol.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>plugin</td>
<td>Any</td>
<td>Plugin instance to check</td>
</tr>
<tr>
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>True if plugin implements the protocol</strong></td>
</tr>
</tbody>
</table>

``` python
# Test helper functions
plugin = MockVLLMPlugin()
plugin.start_server()

print(f"Is lifecycle aware: {is_lifecycle_aware(plugin)}")
print(f"All managed PIDs: {get_all_managed_pids(plugin)}")

# Test with non-lifecycle-aware object
regular_obj = {"not": "a plugin"}
print(f"\nDict is lifecycle aware: {is_lifecycle_aware(regular_obj)}")
print(f"Dict managed PIDs: {get_all_managed_pids(regular_obj)}")

# Cleanup
plugin.force_cleanup()
```

    Started server with PID: 577000
    Is lifecycle aware: True
    All managed PIDs: [577000]

    Dict is lifecycle aware: False
    Dict managed PIDs: []
    Killed server process
